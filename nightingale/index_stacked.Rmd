---
title: rCharts
author: Timely Portfolio
github: {user: timelyportfolio, repo: rCharts_micropolar, branch: "gh-pages"}
framework: bootstrap
mode: selfcontained
highlighter: prettify
hitheme: twitter-bootstrap
assets:
  css:
  - "http://fonts.googleapis.com/css?family=Raleway:300"
  - "http://fonts.googleapis.com/css?family=Oxygen"

---
  
<style>
a {
  color: #08c !important
}

body{
  font-family: 'Oxygen', sans-serif;
  font-size: 16px;
  line-height: 24px;
}

h1,h2,h3,h4 {
  font-family: 'Raleway', sans-serif;
}

.container { width: 900px; }

h3 {
  background-color: #D4DAEC;
    text-indent: 100px; 
}

h4 {
  text-indent: 100px;
}

</style>
  
<a href="https://github.com/timelyportfolio/rCharts_micropolar"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

## micropolar Nightingale Coxcombs Version 2


```{r message = F, warning = F, error = F, echo = F, tidy = F, cache = F}
require(knitr)
opts_chunk$set(
  message = F,
  warning = F,
  error = F,
  results = 'asis',
  tidy = F,
  cache = F,
  fig.width = 8,
  fig.height = 5,
  rcharts="draft"
)
path = paste0(getwd(),"/libraries/widgets/micropolar")
```


### Get Data and Dress it Up
Thanks to the [R datasets listing](https://github.com/vincentarelbundock/Rdatasets/) I discovered that there is a `Nightingale` dataset in the `HistData` package.  The data is not big, but this still saved quite of bit of time.

```{r}
# Thanks to the R datasets github repo
# http://vincentarelbundock.github.io/Rdatasets/doc/HistData/Nightingale.html

library(HistData)
data(Nightingale)


# transform our data to a good format for rCharts
night.df <- data.frame(
  1 : nrow(Nightingale) * 180 / nrow(Nightingale),
  # make numeric javascript date
  as.numeric(as.POSIXct(as.Date(Nightingale[,1])))*1000, 
  apply(Nightingale[,8:10], MARGIN = 1, sum)
)
colnames( night.df ) <- c( "number", "date", "rate" )
night.df$regime <- c(rep('Before', 12), rep('After', 12))
night.df$month <- format(as.Date(Nightingale$Date), "%b %Y")



##### original code for reference

# For some graphs, it is more convenient to reshape death rates to long format
#  keep only Date and death rates
require(reshape)
Night<- Nightingale[,c(1,8:10)]
melted <- melt(Night, "Date")
names(melted) <- c("Date", "Cause", "Deaths")
melted$Cause <- sub("\\.rate", "", melted$Cause)
melted$Regime <- ordered( rep(c(rep('Before', 12), rep('After', 12)), 3), levels=c('Before', 'After'))
Night <- melted
Night$Month <- format(Night$Date, "%b %Y")
# make numeric javascript date
#Night$Date <- as.numeric(as.POSIXct(as.Date(Night$Date)))*1000
```

###  Interactive Charts

<div class="row">
<div id = "chart1" class = "span4"></div>
<div id = "chart2" class = "span4"></div>
</div>

Below is the code to generate the charts above.

```{r}
require(rCharts)
add_ext_widgets(path)


make_dataset = function(data = data){
  lapply(toJSONArray2(data, json = F, names = F), unlist)
}


nightPlot <- rCharts$new()
nightPlot$setLib( path )
nightPlot$set(
  #remove [1:12] if you want Before and After to show on same plot
  #data = make_dataset( night.df[1:12,c(2,3,1,4,5)] ),  
  data = make_dataset( subset(Night, Regime == "Before")[,c("Month","Deaths","Date","Cause", "Regime")] ),
  radialDomain = c( 0, ceiling( max(night.df$rate) ) ),
  angularDomain = 
    night.df$month[1:12],
    #paste0(
    #  "#!d3.time.format('%b %Y')(new Date(",
    #  subset(night.df, regime == "Before")$date[1:12],
    #  subset(Night, Regime == "Before")$Date[1:12],
    #  "))!#"),
  type = "areaChart",
  minorTicks = 0,#3,
  radialTicksSuffix = '',
  height = 300,
  width = 300
)
cat(nightPlot$html(chartId="chart1"))


nightPlot <- rCharts$new()
nightPlot$setLib( path )
nightPlot$set(
  data = make_dataset( x = "month", y = "rate", night.df[13:24,] ),
  #data = make_dataset( x = "Month", y = "Deaths", subset(Night, Regime == "After") ),
  radialDomain = c( 0, ceiling( max(night.df$rate) ) ),
  angularDomain = 
    subset(night.df, regime == "After")$month[1:12],
    #paste0(
    #  "#!d3.time.format('%b %Y')(new Date(",
    #  subset(Night, Regime == "After")$Date[1:12],
    #  "))!#"),
  type = "areaChart",
  minorTicks = 0,
  radialTicksSuffix = '',
  height = 300,
  width = 300
)
cat(nightPlot$html(chartId="chart3"))
```

<script>
  d3.nest().key(function(d){return d[0]}).entries(_datum);

  var marks = d3.selectAll(".mark");
  marks.filter(function(d){return d[3] == "Disease"}).style("fill","green");
</script>

### Thanks
Thanks to [Chris Viau](http://github.com/biovisualize), [Ramnath Vaidyanathan](http://github.com/ramanthv), and [Vincent Arelbundock](https://github.com/vincentarelbundock).